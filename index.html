<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>防伪查询</title>
  <style>
    body { font-family: "Microsoft YaHei", sans-serif; background: #f0f0f0; margin: 0; padding: 20px; color: #000; }
    .container { max-width: 800px; margin: auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .top-image { display: block; width: calc(100% + 40px); margin: -20px -20px 15px; object-fit: contain; }
    .info-block { font-size: 18px; font-weight: bold; margin: 10px 0; }
    p { font-size: 16px; margin: 10px 0; }
    .border-box { border: 1px dashed #333; padding: 10px; margin: 40px 0 20px; text-align: left; font-size: 16px; }
    .code-black { font-size: 20px; color: #000; letter-spacing: 2px; }
    .code-row { display: flex; justify-content: center; gap: 20px; margin: 10px 0; }
    .digit-group { text-align: center; }
    .digit { font-size: 22px; }
    .label { font-size: 12px; margin-top: 4px; }
    .color-0 .digit, .color-0 .label { color: #008000; }
    .color-1 .digit, .color-1 .label { color: #b4005a; }
    .color-2 .digit, .color-2 .label { color: #000; }
    .color-3 .digit, .color-3 .label { color: #0096ff; }
    .qr-area { text-align: center; margin-top: 30px; }
    canvas#qrCanvas { width: 180px; height: 180px; }
  </style>
  <!-- 引入二维码生成库 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
  <div class="container">
    <img class="top-image" src="logo.jpg" alt="品牌Logo">
    <div class="info-block">尊敬的用户您好</div>
    <p>您所查询的16位防伪码为：<span class="code-black" id="blackCode">加载中...</span></p>
    <p>此防伪码正确，该产品为正品，感谢您的查询！</p>
    <div class="border-box">原产地：美国</div>
    <p style="margin-top:40px;">请核对16位防伪码及二维码颜色：</p><br><br>
    <div id="codeRow1" class="code-row"></div>
    <div id="codeRow2" class="code-row"></div>

    <!-- 自动生成的彩色二维码 -->
    <div class="qr-area">
      <div id="qrContainer"></div>
    </div>
  </div>

  <script>
    // 获取 URL 参数
    const params = new URLSearchParams(window.location.search);
    const code = params.get('code') || '1234567812345678';
    document.getElementById('blackCode').textContent = code;

    // 渲染彩色防伪码
    const colorSeq = [0,1,2,3,1,2,3,0,2,3,0,1,3,0,1,2];
    const colorNames = ['绿','红','黑','蓝'];
    function renderCodeLines(str) {
      const r1 = document.getElementById('codeRow1'); r1.innerHTML = '';
      const r2 = document.getElementById('codeRow2'); r2.innerHTML = '';
      for(let i=0;i<8;i++){ const grp=document.createElement('div'); grp.className='digit-group color-'+colorSeq[i]; grp.innerHTML=`<div class="digit">${str[i]}</div><div class="label">${colorNames[colorSeq[i]]}</div>`; r1.appendChild(grp);}      
      for(let i=8;i<16;i++){ const grp=document.createElement('div'); grp.className='digit-group color-'+colorSeq[i]; grp.innerHTML=`<div class="digit">${str[i]}</div><div class="label">${colorNames[colorSeq[i]]}</div>`; r2.appendChild(grp);}    }
    renderCodeLines(code);

    // 自动生成并着色二维码
    const baseUrl = window.location.origin + window.location.pathname + '?code=' + code;
    const qr = new QRCode(document.getElementById('qrContainer'), { text: baseUrl, width:180, height:180, correctLevel: QRCode.CorrectLevel.H });
    // 着色
    setTimeout(()=>{
      const canvas = document.querySelector('#qrContainer canvas');
      const ctx = canvas.getContext('2d');
      const w = canvas.width, h = canvas.height;
      const imgData = ctx.getImageData(0,0,w,h);
      for(let i=0;i<imgData.data.length;i+=4){
        const r=imgData.data[i], g=imgData.data[i+1], b=imgData.data[i+2];
        if(r<50&&g<50&&b<50){
          const idx = ((i/4)%w < w/2 ? 0:1) + ((Math.floor((i/4)/w)<h/2?0:2));
          const cols=[[0,128,0],[180,0,90],[0,0,0],[0,150,255]][idx];
          imgData.data[i]=cols[0]; imgData.data[i+1]=cols[1]; imgData.data[i+2]=cols[2];
        }
      }
      ctx.putImageData(imgData,0,0);
    },500);
  </script>
</body>
</html>

